<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุชุทุจูู ุงูุฎุชูุฉ ุงูุฑูุถุงููุฉ | ุงูููู ุงูุชููู</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;500;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Tajawal', sans-serif; background-color: #f8faf9; }
        .emerald-gradient { background: linear-gradient(135deg, #065f46 0%, #064e3b 100%); }
        .prayer-card { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .gold-glow { box-shadow: 0 0 15px rgba(212, 175, 55, 0.3); }
    </style>
</head>
<body class="text-gray-800">

    <div id="onboardingModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/60 hidden p-4 backdrop-blur-sm">
        <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full p-8 relative border-t-8 border-emerald-700">
            <div class="text-center mb-6">
                <h2 class="text-2xl font-bold text-emerald-800">ูุฑุญุจุงู ุจู ูู ุงูุฎุชูุฉ ุงูุฑูุถุงููุฉ</h2>
                <p class="text-gray-500 text-sm mt-2">ููุฌูุฒ ูููู ุงูุดุฎุตู ุงูุฅููุงูู</p>
            </div>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-1">ุงูุงุณู ุงูุซูุงุซู</label>
                    <input type="text" id="userName" class="w-full p-3 border rounded-xl focus:ring-2 focus:ring-emerald-500 outline-none transition">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium mb-1">ุงูุนูุฑ</label>
                        <input type="number" id="userAge" class="w-full p-3 border rounded-xl focus:ring-2 focus:ring-emerald-500 outline-none">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">ุงูุฌูุณ</label>
                        <select id="userGender" class="w-full p-3 border rounded-xl focus:ring-2 focus:ring-emerald-500 outline-none bg-white">
                            <option value="ุฐูุฑ">ุฐูุฑ</option>
                            <option value="ุฃูุซู">ุฃูุซู</option>
                        </select>
                    </div>
                </div>
                <div class="bg-emerald-50 p-4 rounded-xl space-y-3">
                    <div class="flex items-center justify-between">
                        <span class="text-sm font-bold text-emerald-900">ุชูุนูู ุงูุชูุจููุงุช (ุฃู ุงููุฑู)</span>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="notifEnabled" class="sr-only peer">
                            <div class="w-11 h-6 bg-gray-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:bg-emerald-600 after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all"></div>
                        </label>
                    </div>
                    <div id="notifSettings" class="hidden">
                        <select id="notifTiming" class="w-full p-2 border rounded-lg text-sm bg-white">
                            <option value="before">ูุจู ุงูุฃุฐุงู</option>
                            <option value="with">ูุน ุงูุฃุฐุงู</option>
                            <option value="after">ุจุนุฏ ุงูุฃุฐุงู</option>
                        </select>
                    </div>
                </div>
                <button onclick="saveOnboarding()" class="w-full bg-emerald-700 text-white py-3 rounded-xl font-bold hover:bg-emerald-800 transition shadow-lg">ุงุจุฏุฃ ุฑุญูุชู</button>
            </div>
        </div>
    </div>

    <div id="mainApp" class="max-w-4xl mx-auto pb-20 px-4">
        <header class="py-10">
            <div class="flex justify-between items-center mb-8">
                <div>
                    <h1 id="welcomeText" class="text-2xl font-extrabold text-emerald-900 italic">ุชูุจู ุงููู ุทุงุนุชู</h1>
                    <p id="motivationalMsg" class="text-emerald-600 font-medium"></p>
                </div>
                <button onclick="confirmReset()" class="p-3 bg-red-50 text-red-600 rounded-full hover:bg-red-600 hover:text-white transition shadow-sm" title="ุฅุนุงุฏุฉ ุถุจุท">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                    </svg>
                </button>
            </div>

            <div class="emerald-gradient rounded-3xl p-8 text-white shadow-2xl relative overflow-hidden border-b-4 border-yellow-500">
                <div class="relative z-10">
                    <div class="flex justify-between items-center mb-6">
                        <div>
                            <p class="text-xs opacity-80 mb-1">ูุณุจุฉ ุงูุฅูุฌุงุฒ ุงููููุฉ</p>
                            <span class="text-5xl font-black" id="progressPercent">0%</span>
                        </div>
                        <div class="text-left bg-white/10 p-4 rounded-2xl backdrop-blur-md border border-white/20">
                            <span class="text-2xl font-bold block" id="pagesCount">0 / 604</span>
                            <p class="text-[10px] opacity-70 tracking-widest uppercase">ุตูุญุฉ</p>
                        </div>
                    </div>
                    <div class="w-full bg-black/20 rounded-full h-4 mb-4">
                        <div id="progressBar" class="bg-yellow-400 h-4 rounded-full shadow-[0_0_15px_rgba(250,204,21,0.5)] transition-all duration-1000" style="width: 0%"></div>
                    </div>
                    <p class="text-sm font-medium" id="remainingPages">ุจุงูุชุธุงุฑ ุจุฏุก ูููู ุงูุฃูู..</p>
                </div>
            </div>
        </header>

        <main class="space-y-8">
            <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="font-bold text-lg text-emerald-900 flex items-center">
                        <span class="bg-emerald-100 p-2 rounded-lg ml-3">๐</span> ูุฑุฏ ุงูููู
                    </h3>
                    <button onclick="markDayComplete()" class="text-sm font-bold bg-yellow-500 text-white px-4 py-2 rounded-xl hover:bg-yellow-600 transition">ุฅููุงู ุงูููู ุจุงููุงูู</button>
                </div>
                
                <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-4">
                    <div onclick="togglePrayer(0)" id="p0" class="prayer-card cursor-pointer border-2 border-dashed border-gray-200 rounded-2xl p-4 text-center hover:scale-105 active:scale-95">
                        <div class="text-3xl mb-2">๐</div>
                        <div class="font-bold text-sm">ุงููุฌุฑ</div>
                        <div class="text-[10px] font-bold mt-1 text-emerald-600 bg-emerald-50 rounded-full py-0.5">5 ุตูุญุงุช</div>
                    </div>
                    <div onclick="togglePrayer(1)" id="p1" class="prayer-card cursor-pointer border-2 border-dashed border-gray-200 rounded-2xl p-4 text-center hover:scale-105">
                        <div class="text-3xl mb-2">โ๏ธ</div>
                        <div class="font-bold text-sm">ุงูุธูุฑ</div>
                        <div class="text-[10px] text-gray-400 mt-1">4 ุตูุญุงุช</div>
                    </div>
                    <div onclick="togglePrayer(2)" id="p2" class="prayer-card cursor-pointer border-2 border-dashed border-gray-200 rounded-2xl p-4 text-center hover:scale-105">
                        <div class="text-3xl mb-2">๐</div>
                        <div class="font-bold text-sm">ุงูุนุตุฑ</div>
                        <div class="text-[10px] text-gray-400 mt-1">4 ุตูุญุงุช</div>
                    </div>
                    <div onclick="togglePrayer(3)" id="p3" class="prayer-card cursor-pointer border-2 border-dashed border-gray-200 rounded-2xl p-4 text-center hover:scale-105">
                        <div class="text-3xl mb-2">๐</div>
                        <div class="font-bold text-sm">ุงููุบุฑุจ</div>
                        <div class="text-[10px] text-gray-400 mt-1">4 ุตูุญุงุช</div>
                    </div>
                    <div onclick="togglePrayer(4)" id="p4" class="prayer-card cursor-pointer border-2 border-dashed border-gray-200 rounded-2xl p-4 text-center hover:scale-105">
                        <div class="text-3xl mb-2">๐</div>
                        <div class="font-bold text-sm">ุงูุนุดุงุก</div>
                        <div class="text-[10px] text-gray-400 mt-1">4 ุตูุญุงุช</div>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-2xl p-6 border-r-8 border-yellow-500 shadow-sm">
                <h3 class="font-bold text-emerald-900 mb-2">ุงูููู ุงูุชููู</h3>
                <p class="text-sm text-gray-600 leading-relaxed">ูุฐุง ุงูุชุทุจูู ูุจุงุฏุฑุฉ ุฎูุฑูุฉ ุชูููุฉ ุชุถูู ูู ุงูุฎุตูุตูุฉ ุงููุงููุฉ. ูุง ูุชู ุฅุฑุณุงู ุจูุงูุงุชู ูุฃู ุฎุงุฏู ุฎุงุฑุฌูุ ุจู ุชูุญูุธ ูู "ุฐุงูุฑุฉ ูุชุตูุญู" ููุท.</p>
                <button class="mt-4 text-emerald-700 text-sm font-extrabold underline decoration-yellow-500 underline-offset-4">ุฏุนู ุงููุจุงุฏุฑุฉ ูุนูู ุฎูุฑู</button>
            </div>
        </main>
    </div>

    <div id="resetModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/70 hidden p-4 backdrop-blur-sm">
        <div class="bg-white rounded-2xl p-8 max-w-sm w-full text-center shadow-2xl">
            <h3 class="text-xl font-bold text-gray-900 mb-2">ุชุตููุฑ ุงูุฎุชูุฉุ</h3>
            <p class="text-gray-500 text-sm mb-6">ุณูุชู ุญุฐู ูุงูุฉ ุงูุฅูุฌุงุฒุงุช ูุงูุจุฏุก ูู ุฌุฏูุฏ. ูู ุฃูุช ูุชุฃูุฏุ</p>
            <div class="flex gap-3">
                <button onclick="resetData()" class="flex-1 bg-red-600 text-white py-3 rounded-xl font-bold hover:bg-red-700 transition">ูุนูุ ุงุญุฐู</button>
                <button onclick="closeReset()" class="flex-1 bg-gray-100 text-gray-800 py-3 rounded-xl font-bold">ุฅูุบุงุก</button>
            </div>
        </div>
    </div>

    <script>
        // ุงูุฅุนุฏุงุฏุงุช ุงูุฃุณุงุณูุฉ
        const TOTAL_PAGES = 604;
        let userData = {
            profile: null,
            progress: Array(30).fill(null).map(() => [false, false, false, false, false]),
            currentDay: 0,
            pagesRead: 0
        };

        // ุชุดุบูู ุงูุชุทุจูู
        window.onload = () => {
            const saved = localStorage.getItem('ramadan_khatma_final');
            if (saved) {
                userData = JSON.parse(saved);
                document.getElementById('onboardingModal').classList.add('hidden');
                updateUI();
            } else {
                document.getElementById('onboardingModal').classList.remove('hidden');
            }
            setMotivMsg();
        };

        // ุญูุธ ููู ุงููุณุชุฎุฏู
        function saveOnboarding() {
            const name = document.getElementById('userName').value.trim();
            const age = document.getElementById('userAge').value;
            if(!name || !age) return alert('ูุฑุฌู ุฅููุงู ุงูุจูุงูุงุช');

            userData.profile = { name, age, gender: document.getElementById('userGender').value };
            saveAndRef();
            document.getElementById('onboardingModal').classList.add('hidden');
        }

        // ููุทู ุงูุชุชุจุน (ุชุนุฏูู ุญุตุฉ ุงููุฌุฑ)
        function togglePrayer(idx) {
            userData.progress[userData.currentDay][idx] = !userData.progress[userData.currentDay][idx];
            calc();
            saveAndRef();
        }

        function markDayComplete() {
            userData.progress[userData.currentDay] = [true, true, true, true, true];
            calc();
            saveAndRef();
        }

        function calc() {
            let total = 0;
            userData.progress.forEach(day => {
                if(day[0]) total += 5; // ุงููุฌุฑ = 5
                if(day[1]) total += 4; // ุงูุธูุฑ = 4
                if(day[2]) total += 4; // ุงูุนุตุฑ = 4
                if(day[3]) total += 4; // ุงููุบุฑุจ = 4
                if(day[4]) total += 4; // ุงูุนุดุงุก = 4
            });
            userData.pagesRead = Math.min(TOTAL_PAGES, total);
            if(userData.pagesRead >= TOTAL_PAGES) triggerConfetti();
        }

        // ุชุญุฏูุซ ุงููุงุฌูุฉ
        function updateUI() {
            if(!userData.profile) return;
            document.getElementById('welcomeText').innerText = `ุฃููุงู ุจูุ ${userData.profile.name.split(' ')[0]}`;
            const perc = ((userData.pagesRead / TOTAL_PAGES) * 100).toFixed(1);
            document.getElementById('progressPercent').innerText = perc + '%';
            document.getElementById('progressBar').style.width = perc + '%';
            document.getElementById('pagesCount').innerText = `${userData.pagesRead} / ${TOTAL_PAGES}`;
            
            const rem = TOTAL_PAGES - userData.pagesRead;
            document.getElementById('remainingPages').innerText = rem > 0 ? `ูุชุจูู ูู ${rem} ุตูุญุฉ ูุฎุชู ุงููุตุญู.` : "ูููุฆุงู ูู ุงูุฎุชู!";

            userData.progress[userData.currentDay].forEach((done, i) => {
                const card = document.getElementById(`p${i}`);
                if(done) {
                    card.classList.add('bg-emerald-700', 'text-white', 'border-solid', 'gold-glow');
                    card.classList.remove('border-gray-200', 'border-dashed');
                } else {
                    card.classList.remove('bg-emerald-700', 'text-white', 'border-solid', 'gold-glow');
                    card.classList.add('border-gray-200', 'border-dashed');
                }
            });
        }

        function setMotivMsg() {
            const msgs = ["ุดุฏู ุงููุฆุฒุฑุ ููุฏ ุงูุชุฑุจ ุงููุนุฏ..", "ุงููุฑุขู ุฑุจูุน ุงููููุจุ ุฒูุฏ ููุจู ููุฑุงู.", "ููู ุงูุฌูุนุฉ.. ููุฑู ุณุงุทุน ูุณูุฑุฉ ุงูููู ุชูุงุฏูู."];
            document.getElementById('motivationalMsg').innerText = msgs[new Date().getDay() % 3];
        }

        function saveAndRef() {
            localStorage.setItem('ramadan_khatma_final', JSON.stringify(userData));
            updateUI();
        }

        function confirmReset() { document.getElementById('resetModal').classList.remove('hidden'); }
        function closeReset() { document.getElementById('resetModal').classList.add('hidden'); }
        function resetData() { localStorage.removeItem('ramadan_khatma_final'); location.reload(); }

        function triggerConfetti() {
            confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 }, colors: ['#d4af37', '#065f46'] });
        }

        document.getElementById('notifEnabled').addEventListener('change', (e) => {
            document.getElementById('notifSettings').classList.toggle('hidden', !e.target.checked);
        });
    </script>
</body>
</html>
